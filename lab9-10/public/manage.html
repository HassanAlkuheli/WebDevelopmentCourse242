<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Manage Books</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .table td, .table th { vertical-align: middle; }
    .img-thumb { width: 60px; height: 60px; object-fit: cover; }
  </style>
</head>
<body class="bg-light">
  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3>Manage Books</h3>
      <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#insertModal">Insert new Book</button>
    </div>

    <table class="table table-bordered bg-white">
      <thead class="table-light">
        <tr>
          <th>Id</th>
          <th>Name</th>
          <th>Price</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="bookRows"></tbody>
    </table>
  </div>

  <!-- Insert Modal -->
  <div class="modal fade" id="insertModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Insert Book</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-2">
            <label class="form-label">Title</label>
            <input id="insTitle" class="form-control">
          </div>
          <div class="mb-2">
            <label class="form-label">Description</label>
            <textarea id="insDesc" class="form-control"></textarea>
          </div>
          <div class="mb-2">
            <label class="form-label">Price</label>
            <input id="insPrice" type="number" step="0.01" class="form-control">
          </div>
          <div class="mb-2">
            <label class="form-label">Category</label>
            <input id="insCata" type="number" class="form-control">
          </div>
          <div class="mb-2">
            <label class="form-label">Image URL</label>
            <input id="insImage" class="form-control" value="https://img.freepik.com/free-photo/beautiful-tree-middle-field-covered-with-grass-with-tree-line-background_181624-29267.jpg">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" onclick="insertBook()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Detail Modal -->
  <div class="modal fade" id="detailModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Book Detail</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="detailBody"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Modal -->
  <div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Delete Book</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete <strong id="delName"></strong>?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger" onclick="confirmDelete()">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let books = [];
    let deleteId = null;

    async function loadBooks() {
      const res = await fetch('/books');
      books = await res.json();
      const body = document.getElementById('bookRows');
      body.innerHTML = '';
      books.forEach(b => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${b.id}</td>
          <td>${b.itemname}</td>
          <td>${b.price}</td>
          <td>
            <button class="btn btn-info btn-sm" onclick="showDetail(${b.id})" data-bs-toggle="modal" data-bs-target="#detailModal">Detail</button>
            <button class="btn btn-danger btn-sm" onclick="askDelete(${b.id})" data-bs-toggle="modal" data-bs-target="#deleteModal">Delete</button>
          </td>
        `;
        body.appendChild(tr);
      });
    }

    async function insertBook() {
      const body = {
        itemname: document.getElementById('insTitle').value,
        description: document.getElementById('insDesc').value,
        price: document.getElementById('insPrice').value,
        cata: document.getElementById('insCata').value,
        image: document.getElementById('insImage').value
      };
      await fetch('/books', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      const modal = bootstrap.Modal.getInstance(document.getElementById('insertModal'));
      modal.hide();
      loadBooks();
    }

    function showDetail(id) {
      const b = books.find(x => x.id === id);
      if (!b) return;
      document.getElementById('detailBody').innerHTML = `
        <div class="text-center mb-2"><img class="img-thumb" src="${b.image || ''}" alt=""></div>
        <div><strong>Title:</strong> ${b.itemname}</div>
        <div><strong>Description:</strong> ${b.description}</div>
        <div><strong>Price:</strong> ${b.price}</div>
        <div><strong>Category:</strong> ${b.cata}</div>
      `;
    }

    function askDelete(id) {
      deleteId = id;
      const b = books.find(x => x.id === id);
      document.getElementById('delName').innerText = b ? b.itemname : '';
    }

    async function confirmDelete() {
      if (!deleteId) return;
      await fetch('/books/' + deleteId, { method: 'DELETE' });
      const modal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
      modal.hide();
      loadBooks();
    }

    loadBooks();
  </script>
</body>
</html>
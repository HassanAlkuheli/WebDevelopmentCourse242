<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Manage Books</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-4">
    <button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#insertModal">Insert new Book</button>

    <table class="table table-striped table-bordered bg-white">
      <thead>
        <tr>
          <th>Id</th>
          <th>Name</th>
          <th>price</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="bookRows"></tbody>
    </table>
  </div>

  <!-- Insert Modal -->
  <div class="modal fade" id="insertModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Insert Book</h5></div>
        <div class="modal-body">
          <input class="form-control mb-2" id="insTitle" placeholder="Title">
          <textarea class="form-control mb-2" id="insDesc" placeholder="Description"></textarea>
          <input class="form-control mb-2" id="insPrice" type="number" step="0.01" placeholder="Price">
          <input class="form-control mb-2" id="insCata" type="number" placeholder="Category">
          <input class="form-control mb-2" id="insImage" value="https://img.freepik.com/free-photo/beautiful-tree-middle-field-covered-with-grass-with-tree-line-background_181624-29267.jpg" placeholder="Image URL">
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button class="btn btn-primary" onclick="insertBook()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Detail Modal -->
  <div class="modal fade" id="detailModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Detail</h5></div>
        <div class="modal-body" id="detailBody"></div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Modal -->
  <div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Delete Book</h5></div>
        <div class="modal-body">Delete <strong id="delName"></strong>?</div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-danger" onclick="confirmDelete()">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let books = [];
    let deleteId = null;

    async function loadBooks() {
      const res = await fetch('/books');
      books = await res.json();
      const body = document.getElementById('bookRows');
      body.innerHTML = '';
      books.forEach(b => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${b.id}</td>
          <td>${b.itemname}</td>
          <td>${b.price}</td>
          <td>
            <button class="btn btn-info btn-sm" onclick="showDetail(${b.id})" data-bs-toggle="modal" data-bs-target="#detailModal">Detail</button>
            <button class="btn btn-danger btn-sm" onclick="askDelete(${b.id})" data-bs-toggle="modal" data-bs-target="#deleteModal">Delete</button>
          </td>
        `;
        body.appendChild(tr);
      });
    }

    async function insertBook() {
      const body = {
        itemname: document.getElementById('insTitle').value,
        description: document.getElementById('insDesc').value,
        price: document.getElementById('insPrice').value,
        cata: document.getElementById('insCata').value,
        image: document.getElementById('insImage').value
      };
      await fetch('/books', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      bootstrap.Modal.getInstance(document.getElementById('insertModal')).hide();
      loadBooks();
    }

    function showDetail(id) {
      const b = books.find(x => x.id === id);
      if (!b) return;
      document.getElementById('detailBody').innerHTML = `
        <div><strong>Title:</strong> ${b.itemname}</div>
        <div><strong>Description:</strong> ${b.description}</div>
        <div><strong>Price:</strong> ${b.price}</div>
        <div><strong>Category:</strong> ${b.cata}</div>
      `;
    }

    function askDelete(id) {
      deleteId = id;
      const b = books.find(x => x.id === id);
      document.getElementById('delName').innerText = b ? b.itemname : '';
    }

    async function confirmDelete() {
      if (!deleteId) return;
      await fetch('/books/' + deleteId, { method: 'DELETE' });
      bootstrap.Modal.getInstance(document.getElementById('deleteModal')).hide();
      loadBooks();
    }

    loadBooks();
  </script>
</body>
</html>